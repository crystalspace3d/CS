<shader compiler="xmlshader" name="glslshader">

  <technique priority="200">
    <pass>

      <buffer source="texture coordinate" destination="gl_MultiTexCoord0"/>
      <texture name="tex diffuse" destination="texdiff"/>

      <shader plugin="glsl">
        <vp>
          <program>
            <![CDATA[
              #version 140
              #extension GL_EXT_geometry_shader4 : enable

              out vec2 texcoord;

              void main (void)
              {
                texcoord = gl_MultiTexCoord0.xy;
                gl_Position = ftransform ();
              }
            ]]>
          </program>
        </vp>

        <gp>
          <program>
            <![CDATA[
              #version 140
              #extension GL_EXT_geometry_shader4 : enable

              in vec2 texcoord[];
              out vec2 tc;

              void main (void)
              {
                gl_Position = gl_PositionIn[0];
                tc = texcoord[0];
                EmitVertex ();
                gl_Position = gl_PositionIn[1];
                tc = texcoord[1];
                EmitVertex ();
                gl_Position = gl_PositionIn[2];
                tc = texcoord[2];
                EmitVertex ();
                EndPrimitive ();
              }
            ]]>
          </program>
        </gp>

        <fp>
          <variablemap destination="coeff" type="vector3">
            <![CDATA[1.0,1.0,0.1]]>
          </variablemap>

          <program>
            <![CDATA[
              #version 140
              #extension GL_EXT_geometry_shader4 : enable

              uniform vec3 coeff;
              uniform sampler2D texdiff;
              in vec2 tc;

              void main (void)
              {
                vec4 col = texture2D (texdiff, tc);
                gl_FragColor = col * vec4 (coeff, 0.0);
              }
            ]]>
          </program>
        </fp>
      </shader>

    </pass>
  </technique>

  <technique priority="100">
    <pass>

      <buffer source="texture coordinate" destination="IN.texCoord"/>
      <texture name="tex diffuse" destination="textureDiffuse"/>

      <vp plugin="glcg">
        <cgvp>
          <program>
            <![CDATA[
                     struct App2Vertex
                     {
                       float4 Position : POSITION;
                       float2 texCoord;
                     };
                     
                     struct Vertex2Fragment
                     {
                       float4 Position : POSITION;
                       float2 texCoord;
                     };

                     Vertex2Fragment
                       main (App2Vertex IN,
                             uniform float4x4 ModelViewProj : state.matrix.mvp)
                     {
                       Vertex2Fragment OUT;
                       OUT.Position = mul (ModelViewProj, IN.Position);
                       OUT.texCoord = IN.texCoord;
                       return OUT;
                     }
            ]]>
          </program>
        </cgvp>
      </vp>

      <fp plugin="glcg">
        <cgfp>
          <program>
            <![CDATA[
                     struct Vertex2Fragment
                     {
                       float4 Position : POSITION;
                       float2 texCoord;
                     };

                     float4 main (Vertex2Fragment IN, sampler2D textureDiffuse) : COLOR
                     {
                       return tex2D (textureDiffuse, IN.texCoord);
                     }
            ]]>
          </program>
        </cgfp>
      </fp>

    </pass>
  </technique>
</shader>
