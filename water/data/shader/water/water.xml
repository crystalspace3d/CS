<shader compiler="xmlshader" name="water">
	
	<shadervars>
		<shadervar name="position" type="vector4">-1.0, -1.0, -1.0, 0.0</shadervar>
		<shadervar name="color" type="vector4">0.9, 0.9, 0.9, 1.0</shadervar>
		<shadervar name="shine" type="float">1.0</shadervar>
		<shadervar name="murkiness" type="float">0.3</shadervar>
		
		<!-- Wave properties -->
		<shadervar name="amps" type="vector3">0.1, 0.03, 0.05</shadervar>
		<shadervar name="kxs" type="vector4">1.4, -1.1, 0.5</shadervar>
		<shadervar name="kys" type="vector4">1.6, 0.7, -2.5</shadervar>
		<shadervar name="freqs" type="vector4">2.0, 1.7, 1.6</shadervar>
		<shadervar name="phases" type="vector4">0.0, 1.0, 1.41</shadervar>
		
		<shadervar name="time" type="expression">
	      <sexp>(* "standard time" 1)</sexp>
	    </shadervar>
	    
	</shadervars>

	
  <technique priority="250">
    <pass>
      <mixmode><alpha/></mixmode>
      <buffer source="normal" destination="normal"/>
	  <buffer source="color" destination="color" />
	  <buffer source="texture coordinate 0" destination="texture coordinate 0" />
	
      <vp plugin="glcg" name="Water Vertices">
		<cgvp>
			<variablemap variable="time" destination="time" />
			
			<?if vars."freqs" && vars."kxs" && vars."kys" && vars."amps" && vars."phases"?>
			<variablemap variable="amps" destination="amps" />
			<variablemap variable="kxs" destination="kxs" />
			<variablemap variable="kys" destination="kys" />
			<variablemap variable="freqs" destination="freqs" />
			<variablemap variable="phases" destination="phases" />
			
			<program file="/shader/water/ocean.cgvp"/>
			<?else ?>
			<program file="/shader/water/water.cgvp"/>
			<?endif ?>
		</cgvp>
      </vp>	

	  <texture destination="TexNormal" name="texture normal" />
      <fp plugin="glcg" name="Water pixels">
		<cgfp>
			<variablemap variable="position" destination="lightPos" />
			<variablemap variable="color" destination="lightCol" />
			<variablemap variable="shine" destination="shininess" />
			<variablemap variable="murkiness" destination="waterAlpha" />
			
			<program file="/shader/water/water.cgfp"/>
		</cgfp>
      </fp>
    </pass>
  </technique>
</shader>
